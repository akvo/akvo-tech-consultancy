(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{108:function(e,t,a){},129:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(23),s=a.n(o),i=a(8),l=a(9),c=a(11),u=a(10),d=a(12),h=a(67),p=a(28),m=a(15),g=a(3),b=a(24),f=a.n(b),v=a(14),O=function(e){return{value:e}},S=function(e){return{loadQuestions:function(t){return e({type:"LOAD QUESTIONS",data:t})},changeGroup:function(t){return e({type:"CHANGE GROUP",group:t})},restoreAnswers:function(t){return e({type:"RESTORE ANSWERS",data:t})},reduceAnswer:function(t){return e({type:"REDUCE ANSWER",answer:t})},reduceDataPoint:function(t){return e({type:"REDUCE DATAPOINT",data:t})},checkSubmission:function(){return e({type:"CHECK SUBMISSION"})},submitState:function(t){return e({type:"SUBMIT STATE",data:t})},generateUUID:function(t){return e({type:"GENERATE UUID",data:t})},changeSettings:function(t){return e({type:"PAGES SETTINGS",data:t})},storeCascade:function(t){return e({type:"STORE CASCADE",data:t})}}},y=a(30),j=a.n(y),E=(a(42),a(104),a(63)),k=a(43),I=a(64),w=a.n(I);a(108);function C(){var e=Object(E.a)([" margin: 0 auto; border-color: red; "]);return C=function(){return e},e}var N=Object(k.css)(C()),x=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={color:"#007bff"},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:this.props.styles},r.a.createElement("h3",{className:"mt-2"},"Loading Forms"),r.a.createElement(w.a,{css:N,sizeUnit:"px",size:20,color:this.state.color}))}}]),t}(r.a.Component),A=Object(v.b)(O,S)(x),_=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).getUrl=function(e){return"#"+e.replace(/ /g,"-").toLowerCase()},a.getLoading=function(){return r.a.createElement(A,{styles:"sidebar-loading"})},a.showQuestion=a.showQuestion.bind(Object(g.a)(a)),a.getQuestionList=a.getQuestionList.bind(Object(g.a)(a)),a.listClass="list-group-item list-group-item-action ",a.getUrl=a.getUrl.bind(Object(g.a)(a)),a.state={_showQuestion:""},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"showQuestion",value:function(e){this.props.changeGroup(e)}},{key:"componentDidMount",value:function(){}},{key:"getQuestionList",value:function(e){var t=this;return e.list.map(function(a){return r.a.createElement("div",{className:"list-group list-group-flush",key:"group-"+a.index},r.a.createElement("a",{onClick:function(){t.showQuestion(a.index)},href:t.getUrl(a.heading),className:a.index===e.active?t.listClass+" bg-current":t.listClass+" bg-light"},a.heading))})}},{key:"render",value:function(){return 1===this.props.value.questions.length?this.getLoading():this.getQuestionList(this.props.value.groups)}}]),t}(n.Component),G=Object(v.b)(O,S)(_),D=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).getHeader=function(e){return e.list.filter(function(t){return t.index===e.active}).map(function(e){return r.a.createElement(n.Fragment,{key:e.index},r.a.createElement("h2",{className:"mt-2"},e.heading),r.a.createElement("p",null,e.heading))})},a.getLoading=function(){return r.a.createElement(A,{styles:"header-loading"})},a.getHeader=a.getHeader.bind(Object(g.a)(a)),a.getLoading=a.getLoading.bind(Object(g.a)(a)),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return 1===this.props.value.questions.length?this.getLoading():this.getHeader(this.props.value.groups)}}]),t}(n.Component),P=Object(v.b)(O)(D),R=a(27),T=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:"data-point"},r.a.createElement("h3",{className:"data-point-name"},r.a.createElement(R.e,{color:"#9ea4a8",className:"data-point-icon"}),this.props.value.datapoint),r.a.createElement("span",{className:"data-point-id"},this.props.value.uuid)))}}]),t}(n.Component),U=Object(v.b)(O)(T),q=a(22),L=a(29),F=function(e){var t=e.type;switch(e.validationRule&&(t="numeric"===e.validationRule.validationType?"number":"text"),e.options&&(t="option"),t){case"signature":break;case"photo":return"photo";case"number":return"number";case"option":return"option";case"cascade":return"cascade";case"geo":return"geo";case"date":return"date";default:return"text"}return t},Q=function(e){try{JSON.parse(e)}catch(t){return!1}return!0},M=a(45),J=a(65),z=a.n(J),H=(a(110),a(139)),W=a(140),B=a(131),V=a(141),K=(a(111),a(16)),X=a.n(K);delete X.a.Icon.Default.prototype._getIconUrl,X.a.Icon.Default.mergeOptions({iconRetinaUrl:a(112),iconUrl:a(113),shadowUrl:a(114)});var Z="https://maps.googleapis.com/maps/api/geocode/json",$="AIzaSyCIv2SUL6gt0gOgr8M9XLGpGIpEVwaR4A0",Y=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).toggleDraggable=function(){a.setState({draggable:!a.state.draggable})},a.updateAddress=function(){var e=a.state.marker;a.props.update(e);var t={address:e.lat+","+e.lng,key:$};f.a.get(Z,{params:t}).then(function(e){a.setState({address:e.data.results[0].formatted_address})})},a.updatePosition=function(e){var t={lat:e.target._latlng.lat,lng:e.target._latlng.lng};a.setState({marker:t}),a.updateAddress()},a.getSpanAddress=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{className:"text-right badge badge-secondary"},a.state.address),r.a.createElement("br",null))},a.state={center:{lat:6.48998,lng:18.10546},marker:{lat:6.48998,lng:18.10546},zoom:4,draggable:!0,address:!1,value:""},a.updatePosition=a.updatePosition.bind(Object(g.a)(a)),a.toggleDraggable=a.toggleDraggable.bind(Object(g.a)(a)),a.updateAddress=a.updateAddress.bind(Object(g.a)(a)),a.handleClick=a.handleClick.bind(Object(g.a)(a)),a.handleSearch=a.handleSearch.bind(Object(g.a)(a)),a.handleText=a.handleText.bind(Object(g.a)(a)),a.getSpanAddress=a.getSpanAddress.bind(Object(g.a)(a)),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"handleText",value:function(e){this.setState({value:e.target.value})}},{key:"handleSearch",value:function(){var e=this,t={address:this.state.value,key:$};f.a.get(Z,{params:t}).then(function(t){var a=t.data.results[0].geometry.location,n=t.data.results[0].formatted_address;e.setState({marker:a}),e.refs.map.leafletElement.panTo(a),setTimeout(function(){e.setState({center:a}),e.setState({address:n})},500),e.setState({zoom:17})})}},{key:"handleClick",value:function(e){var t={lat:e.latlng.lat,lng:e.latlng.lng};this.setState({marker:t}),this.updateAddress()}},{key:"componentDidMount",value:function(){var e=this,t={center:this.props.center,marker:this.props.center,zoom:4,draggable:!0,address:!1,value:""},a=this.refs.map.leafletElement;setTimeout(function(){a.invalidateSize(),e.setState(t),e.updateAddress()},3e3)}},{key:"render",value:function(){var e=[this.state.marker.lat,this.state.marker.lng];return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-9"},r.a.createElement("input",{className:"form-control",type:"text",value:this.state.value,onChange:this.handleText,placeholder:"Search Address"})),r.a.createElement("div",{className:"col-md-3"},r.a.createElement("button",{className:"btn btn-block btn-success",onClick:this.handleSearch},"Search"))),r.a.createElement("br",null),r.a.createElement(H.a,{onClick:this.handleClick,center:this.state.center,zoom:this.state.zoom,ref:"map"},r.a.createElement(W.a,{attribution:'&copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),r.a.createElement(B.a,{refs:"marker",position:e,draggable:this.state.draggable,onDragend:this.updatePosition},r.a.createElement(V.a,null,r.a.createElement("div",null,"Current Location:",r.a.createElement("br",null),"Latitude: ",this.state.marker.lat," ",r.a.createElement("br",null),"Longitude: ",this.state.marker.lng," ",r.a.createElement("br",null),"Address: ",this.state.address," ")))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-12 text-center"},r.a.createElement("hr",null),this.state.address?this.getSpanAddress():"",r.a.createElement("span",{className:"badge badge-success"},"lat: ",this.state.marker.lat,", lng: ",this.state.marker.lng))))}}]),t}(n.Component),ee=1;Object(M.registerPlugin)(z.a);var te=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).instanceUrl=window.location.pathname.split("/")[ee],a.value=localStorage.getItem(a.props.data.id),a.other=localStorage.getItem("other_"+a.props.data.id),a.state={value:a.value?a.value:"",other:a.other?a.other:""},a.setDpStorage=a.setDpStorage.bind(Object(g.a)(a)),a.setDplStorage=a.setDplStorage.bind(Object(g.a)(a)),a.getRadio=a.getRadio.bind(Object(g.a)(a)),a.getPhoto=a.getPhoto.bind(Object(g.a)(a)),a.getGeo=a.getGeo.bind(Object(g.a)(a)),a.renderRadio=a.renderRadio.bind(Object(g.a)(a)),a.getCascadeDropdown=a.getCascadeDropdown.bind(Object(g.a)(a)),a.renderCascade=a.renderCascade.bind(Object(g.a)(a)),a.renderCascadeOption=a.renderCascadeOption.bind(Object(g.a)(a)),a.fetchCascade=a.fetchCascade.bind(Object(g.a)(a)),a.limitCascade=0,a.handleChange=a.handleChange.bind(Object(g.a)(a)),a.handleOther=a.handleOther.bind(Object(g.a)(a)),a.handlePhoto=a.handlePhoto.bind(Object(g.a)(a)),a.handleCascadeChange=a.handleCascadeChange.bind(Object(g.a)(a)),a.handleMapChange=a.handleMapChange.bind(Object(g.a)(a)),a.handleGlobal=a.handleGlobal.bind(Object(g.a)(a)),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"handleGlobal",value:function(e,t){this.props.restoreAnswers(this.props.value.questions),this.props.changeGroup(this.props.value.groups.active),this.props.checkSubmission()}},{key:"handleCascadeChange",value:function(e,t,a,n){var r,o={id:e,text:t,option:parseInt(n)};if(localStorage.getItem(a)){var s=JSON.parse(localStorage.getItem(a)).filter(function(t){return t.id<e});r=JSON.stringify([].concat(Object(L.a)(s),[o]))}else r=JSON.stringify([o]);return 0!==e&&(localStorage.setItem(this.props.data.id,r),this.handleGlobal(this.props.data.id,r)),!0}},{key:"handlePhoto",value:function(e){var t=this.props.data.id;localStorage.setItem(t,e),this.setState({value:e}),this.handleGlobal(t,e)}},{key:"handleMapChange",value:function(e){var t=this.props.data.id;e=e.lat+"|"+e.lng+"|0",localStorage.setItem(t,e),this.setState({value:e}),parseInt(localStorage.getItem("_dplOrder"))===t&&localStorage.setItem("_dataPointLocation",e),this.handleGlobal(t,e)}},{key:"handleChange",value:function(e){var t=this.props.data.id,a=e.target.value,n=e.target.id;if(n.split("_")[0])return this.handleOther(n,a);if("cascade"===this.props.data.type){var r=e.target.selectedIndex,o=e.target[r].text,s=parseInt(e.target.name.split("-")[1])+1;this.handleCascadeChange(s,o,t,a),this.limitCascade>s&&this.getCascadeDropdown(a,s)}else if(this.props.data.options&&this.props.data.options.allowMultiple){var i=[];if(localStorage.getItem(t)&&(i=JSON.parse(localStorage.getItem(t))),-1===i.indexOf(a)?i.push(a):i.splice(i.indexOf(a),1),i.length>0?(localStorage.setItem(t,JSON.stringify(i)),this.setState({value:i}),this.handleGlobal(t,a)):(localStorage.removeItem(t),this.setState({value:""})),this.props.data.options.allowOther){if("Other Option"===a&&e.target.checked){var l="other_"+this.props.data.id.toString();this.setState(Object(q.a)({},l,!0))}if("Other Option"===a&&!e.target.checked){var c="other_"+this.props.data.id.toString();this.setState(Object(q.a)({},c,!1))}}this.handleGlobal(t,a)}else localStorage.setItem(t,a),this.setState({value:a}),this.handleGlobal(t,a);if(""===a&&(this.setState({value:a}),localStorage.removeItem(t),this.handleGlobal(t,a)),this.props.data.localeNameFlag){var u=JSON.parse(localStorage.getItem("_dpOrder")),d=[];u.map(function(e){var t=localStorage.getItem(e);t&&(Q(t)&&isNaN(t)?JSON.parse(t).map(function(e){return e.text}).forEach(function(e){d.push(e)}):d.push(t));return!0});var h=d.join(" - ");localStorage.setItem("_dataPointName",h),this.props.reduceDataPoint(localStorage.getItem("_dataPointName"))}}},{key:"handleOther",value:function(e,t){var a="";localStorage.getItem(e)&&(a=localStorage.getItem(e)),a=t,localStorage.setItem(e,a),this.setState({other:a})}},{key:"setDpStorage",value:function(){if(localStorage.getItem("_dpOrder")){var e=JSON.parse(localStorage.getItem("_dpOrder"));e.includes(this.props.data.id)||e.push(this.props.data.id),localStorage.setItem("_dpOrder",JSON.stringify(e))}else localStorage.setItem("_dpOrder",JSON.stringify([this.props.data.id]))}},{key:"setDplStorage",value:function(){localStorage.setItem("_dplOrder",this.props.data.id)}},{key:"getRadio",value:function(e,t){var a=this,n=e.options;void 0===n.allowMultiple&&(n=Object(m.a)({},n,{allowMultiple:!1}));var r=n.allowMultiple?"checkbox":"radio";if(n.allowOther){if(n.option.length>1){var o=n.option.length+1,s=n.option.map(function(n,o){return a.renderRadio(!1,n,o,e.id,r,t)}),i=this.renderRadio(!0,{text:"Other",value:"Other Option"},o,e.id,r,t);return[].concat(Object(L.a)(s),[i])}var l=this.renderRadio(!1,n.option,0,e.id,r,t),c=this.renderRadio(!0,{text:"Other",value:"Other Option"},1,e.id,r,t);return[].concat(Object(L.a)(l),[c])}return n.option.length>1?n.option.map(function(n,o){return a.renderRadio(!1,n,o,e.id,r,t)}):this.renderRadio(!1,n.option,0,e.id,r,t)}},{key:"renderRadio",value:function(e,t,a,n,o,s){var i=function(){return localStorage.getItem(n)===t.value};if("checkbox"===o&&this.state.value.indexOf(t.value)>=0&&(i=function(){return!0}),e){var l="other_"+n.toString();return r.a.createElement("div",{key:s+"-div-radio-"+a.toString()},r.a.createElement("div",{className:"form-check"},r.a.createElement("input",{key:s+"-radio-"+a.toString(),className:"form-check-input",type:o,name:n,value:t.value,onChange:this.handleChange,checked:i()}),r.a.createElement("label",{className:"form-check-label badge badge-secondary",htmlFor:"input-"+n.toString()},t.text)),r.a.createElement("hr",null),r.a.createElement("div",{className:i()?"":"hidden"},r.a.createElement("label",{className:"form-label",htmlFor:l},"Other Answer:"),r.a.createElement("input",{className:"form-control",key:s+"-radio-other-"+a.toString(),value:this.state.other,type:"text",name:l,id:l,onChange:this.handleChange})))}return r.a.createElement("div",{className:"form-check",key:s+"-div-radio-"+a.toString()},r.a.createElement("input",{key:s+"-radio-"+a.toString(),className:"form-check-input",type:o,name:n,value:t.value,onChange:this.handleChange,checked:i()}),r.a.createElement("label",{className:"form-check-label",htmlFor:"input-"+(n+a).toString()},t.text))}},{key:"getCascade",value:function(e,t,a){var n=this;if(Array.isArray(e.levels.level)){var r=e.levels.level.length-1;return e.levels.level.map(function(e,t){return n.limitCascade=t+1,n.renderCascade(e,t,r,a)})}return this.limitCascade=1,this.renderCascade(e.levels.level,0,0,a)}},{key:"renderCascade",value:function(e,t,a,n){var o=[],s="cascade_"+t,i=this.state[this.state[s]],l=r.a.createElement("div",{key:n+"-dropdown-"+t},r.a.createElement("div",null,e.text),r.a.createElement("select",{className:"form-control",value:this.state.selected,type:"select",name:this.props.data.id.toString()+"-"+t,onChange:this.handleChange},r.a.createElement("option",{key:n+"-cascade-options-0",value:this.state.value},"Please Select"),this.renderCascadeOption(i,t+1,e.text,n)));return o.push(l),this.limitCascade<=t&&this.handleChange(),o.map(function(e,t){return e})}},{key:"renderCascadeOption",value:function(e,t,a){if(e)return e.map(function(e,t){return r.a.createElement("option",{key:a+"-cascade-options-"+t,value:e.id},e.name)})}},{key:"getCascadeDropdown",value:function(e,t){if("cascade"===this.props.data.type){var a,n="http://localhost:5000/cascade/"+this.instanceUrl+"/"+this.props.data.cascadeResource+"/"+e,r="options_"+e,o="cascade_"+t,s=this.props.value.cascade,i=!1;if(s.length>0&&(i=!0),i&&(a=s.filter(function(e){return e.url===n})[0]),a)try{var l;this.setState((l={},Object(q.a)(l,r,a.data),Object(q.a)(l,o,[r]),Object(q.a)(l,"value",a.data[t].id),l))}catch(c){localStorage.removeItem(this.props.data.id)}a||this.fetchCascade(e,t,n,r,o)}}},{key:"fetchCascade",value:function(e,t,a,n,r){var o=this;f.a.get(a).then(function(e){try{var a;o.setState((a={},Object(q.a)(a,n,e.data),Object(q.a)(a,r,[n]),Object(q.a)(a,"value",e.data[t].id),a))}catch(s){localStorage.removeItem(o.props.data.id)}return e}).then(function(e){o.props.storeCascade({url:a,data:e.data})})}},{key:"getInput",value:function(e,t,a,n,o){return r.a.createElement("input",{className:"photo"===e.type?"form-control-file":"form-control",value:n||"",min:a.minVal?a.minVal:"",max:a.maxVal?a.maxVal:"",key:t,type:o,name:"Q-"+e.id.toString(),onChange:this.handleChange})}},{key:"getInputOther",value:function(e,t,a,n){return r.a.createElement("input",{className:"photo"===e.type?"form-control-file":"form-control",value:a||"",key:t,type:n,name:"Q-"+e.id.toString(),onChange:this.handleChange})}},{key:"getPhoto",value:function(e,t,a,n){var o=this;return r.a.createElement(M.FilePond,{server:{url:"http://localhost:5000/",process:{url:"upload-image",method:"POST",onload:function(e){return o.handlePhoto(e),e.key},onerror:function(e){return e.data},ondata:function(e){return e.append("Status","Uploaded"),e}},patch:{url:".upload-image",method:"GET",onload:function(e){return o.handlePhoto(e),e.key},onerror:function(e){return e.data}},revert:{url:".delete-image/"+localStorage.getItem(e.id),method:"GET",onload:function(t){localStorage.removeItem(e.id)}}},key:t,allowMultiple:!1,name:"Q-"+e.id.toString(),"data-max-file-size":"500kb"})}},{key:"getTextArea",value:function(e,t,a,n){return r.a.createElement("textarea",{key:t,rows:"3",className:"form-control",value:a||"",type:n,onChange:this.handleChange,name:"Q-"+e.id.toString()})}},{key:"getGeo",value:function(e,t){var a=this.props.data.id,n={lat:51.505,lng:-.09};return localStorage.getItem(a)&&(n={lat:(n=(n=localStorage.getItem(a)).split("|"))[0],lng:n[1]}),r.a.createElement(Y,{center:n,zoom:13,update:this.handleMapChange})}},{key:"componentDidMount",value:function(){"cascade"===this.props.data.type&&(localStorage.removeItem(this.props.data.id),this.getCascadeDropdown(0,0)),null!==localStorage.getItem(this.props.data.id)&&this.props.checkSubmission()}},{key:"render",value:function(){var e=this.props.data,t="question-form-"+e.id.toString(),a=e.type,n=localStorage.getItem(e.id);switch(e.localeNameFlag&&this.setDpStorage(),"localeLocationFlag"in e&&this.setDplStorage(),a){case"option":return this.getRadio(e,t);case"cascade":return this.getCascade(e,0,t);case"number":return this.getInput(e,t,e.validationRule,n,a);case"photo":return this.getPhoto(e,t,n,"file");case"date":return this.getInputOther(e,t,n,a);case"geo":return this.getGeo(e,t);default:return this.getTextArea(e,t,n,a)}}}]),t}(n.Component),ae=Object(v.b)(O,S)(te),ne=a(132),re=a(133),oe=a(134),se=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).getForms=a.getForms.bind(Object(g.a)(a)),a.isJsonString=a.isJsonString.bind(Object(g.a)(a)),a.renderMandatoryIcon=a.renderMandatoryIcon.bind(Object(g.a)(a)),a.renderQuestion=a.renderQuestion.bind(Object(g.a)(a)),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"isJsonString",value:function(e){try{JSON.parse(e)}catch(t){return!1}return!0}},{key:"renderQuestion",value:function(e,t){return r.a.createElement(ae,{key:"question-type-"+e,data:t})}},{key:"renderMandatoryIcon",value:function(e){var t=!1;return localStorage.getItem(e)&&(t=!0),function(e){return e?r.a.createElement(R.c,{color:"green",className:"float-right"}):r.a.createElement(R.d,{color:"red",className:"float-right"})}(t)}},{key:"getForms",value:function(e){var t=this;return e.map(function(e){var a=e.id.toString();return r.a.createElement(ne.a,{key:"card-"+a,className:!1===e.show?"d-none":""},r.a.createElement(re.a,{key:"card-body-"+a,id:"card-body-"+a},r.a.createElement(oe.a,{key:"card-title-"+a},e.order.toString()+". "+e.text,e.mandatory?t.renderMandatoryIcon(a):""),t.renderQuestion(a,e)))})}},{key:"render",value:function(){return this.getForms(this.props.value.questions)}}]),t}(n.Component),ie=Object(v.b)(O)(se),le=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).showGroup=a.showGroup.bind(Object(g.a)(a)),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"showGroup",value:function(e){return this.props.changeGroup(e)}},{key:"render",value:function(){var e=this,t=this.props.value.groups.active<=1?"btn-secondary":"btn-primary",a=this.props.value.groups.active===this.props.value.groups.list.length?"btn-secondary":"btn-primary",n=this.props.value.groups.active-1,o=this.props.value.groups.active+1;return r.a.createElement("div",{className:"btn btn-group ml-auto mt-2 mt-lg-0"},r.a.createElement("button",{className:"btn "+t,onClick:function(){e.showGroup(n)}},"Prev"),r.a.createElement("button",{className:"btn "+a,onClick:function(){e.showGroup(o)}},"Next"))}}]),t}(n.Component),ce=Object(v.b)(O,S)(le),ue=a(138),de=a(135),he=a(136),pe=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"sidebar-heading"},r.a.createElement("div",{className:"my-2"},r.a.createElement(ue.a,null,r.a.createElement(de.a,null,this.props.value.surveyName),r.a.createElement(he.a,null,"Survey ID: ",this.props.value.surveyId,r.a.createElement("br",null),"Version: ",this.props.value.version))))}}]),t}(n.Component),me=Object(v.b)(O)(pe),ge=a(69),be=a(137),fe="6Lejm74UAAAAAA6HkQwn6rkZ7mxGwIjOx_vgNzWC",ve=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleCaptcha=function(e){a.setState({captcha:e}),a.props.submitState(!0),null===a.state.captcha&&a.setState({expired:!0})},a.asyncScriptOnLoad=function(){a.setState({callback:"called!"})},a.showCaptcha=function(){return r.a.createElement(ge.a,{style:{display:"block",overflow:"hidden",borderBottom:"1px solid #ddd",padding:"8px"},size:"normal",theme:"light",ref:a._reCaptchaRef,sitekey:fe,onChange:a.handleCaptcha,asyncScriptOnLoad:a.asyncScriptOnLoad})},a.showPassword=function(){return r.a.createElement(n.Fragment,null,r.a.createElement("label",{className:"form-password-label",htmlFor:"submit-username"},"Username:"),r.a.createElement("input",{className:"form-control",type:"text",name:"submit-username",onChange:a.handleUser}),r.a.createElement("label",{className:"form-password-label",htmlFor:"submit-password"},"Password:"),r.a.createElement("input",{className:"form-control",type:"password",name:"submit-password",onChange:a.handlePassword}),r.a.createElement("hr",null))},a.showSpinner=function(e){return r.a.createElement(be.a,{size:"sm",color:"light"})},a.showCaptcha=a.showCaptcha.bind(Object(g.a)(a)),a.showPassword=a.showPassword.bind(Object(g.a)(a)),a.submitForm=a.submitForm.bind(Object(g.a)(a)),a.handleCaptcha=a.handleCaptcha.bind(Object(g.a)(a)),a.handlePassword=a.handlePassword.bind(Object(g.a)(a)),a.handleUser=a.handleUser.bind(Object(g.a)(a)),a.showSpinner=a.showSpinner.bind(Object(g.a)(a)),a.state={_showCaptcha:a.props.value.captcha,_showSpinner:!1},a._reCaptchaRef=r.a.createRef(),a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"handlePassword",value:function(e){localStorage.setItem("_password",e.target.value)}},{key:"handleUser",value:function(e){localStorage.setItem("_username",e.target.value)}},{key:"submitForm",value:function(){var e=this;localStorage.setItem("_submissionStop",Date.now()),this.setState({_showSpinner:!0});var t=JSON.stringify(localStorage).length.toString(),a=localStorage;f.a.post("http://localhost:5000/submit-form",a,{headers:{"Content-Length":t,"Content-Type":"application/json"}}).then(function(t){return j()({icon:"success",title:"Success!",text:"New datapoint is sent! clearing form...",closeOnClickOutside:!1,closeOnEsc:!1,button:!1,timer:3200}),e.setState({_showSpinner:!1}),setTimeout(function(){localStorage.clear(),setTimeout(function(){window.location.replace(window.location.origin+window.location.pathname)},3e3)},500),t}).catch(function(t,a){console.log(t,a),e.setState({_showSpinner:!1}),j()("Oops!","Something went wrong!","error")})}},{key:"render",value:function(){return r.a.createElement(n.Fragment,null,!!this.props.value.captcha&&this.showCaptcha(),r.a.createElement("div",{className:"submit-block"},!!this.props.value.submit&&this.showPassword(),r.a.createElement("button",{onClick:this.submitForm,className:"btn btn-block btn-"+(this.props.value.submit?"primary":"secondary"),disabled:!this.props.value.submit},this.state._showSpinner?r.a.createElement(be.a,{size:"sm",color:"light"}):"",r.a.createElement("span",null,"Submit"))))}}]),t}(n.Component),Oe=Object(v.b)(O,S)(ve),Se="http://localhost:5000/",ye=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).updateData=function(e){a.props.loadQuestions(e),a.props.restoreAnswers(a.props.value.questions),localStorage.getItem("_dataPointName")&&a.props.reduceDataPoint(localStorage.getItem("_dataPointName")),a.props.changeGroup(1),localStorage.setItem("_version",e.version),localStorage.setItem("_instanceId",e.app);var t=[],n=[];Array.isArray(e.questionGroup)||(e.questionGroup=[e.questionGroup]),e.questionGroup.forEach(function(e){e.question.forEach(function(e,a){t.push(e.id),n.push(e.type.toUpperCase())})}),localStorage.setItem("questionId",t),localStorage.setItem("answerType",n),a.setState(Object(m.a)({},e));var r=[Math.random().toString(36).slice(2).substring(1,5),Math.random().toString(36).slice(2).substring(1,5),Math.random().toString(36).slice(2).substring(1,5)];localStorage.setItem("_dataPointId",r.join("-")),localStorage.setItem("_submissionStart",Date.now()),localStorage.setItem("_deviceId","Akvo Flow Web")},a.updateQuestions=function(e){a.setState({questionIndex:e})},a.instance=a.props.match.params.instance,a.surveyId=a.props.match.params.surveyid,a.setFullscreen=a.setFullscreen.bind(Object(g.a)(a)),a.renderQuestions=a.renderQuestions.bind(Object(g.a)(a)),a.renderGroups=a.renderGroups.bind(Object(g.a)(a)),a.state={_fullScreen:!1,_rendered:!1},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"setFullscreen",value:function(){var e=this.state._fullscreen;this.setState({_fullscreen:!e})}},{key:"componentDidMount",value:function(){var e=this;this.props.generateUUID({}),this.props.changeSettings({_isLoading:!0}),localStorage.getItem("_formId")&&localStorage.getItem("_formId")!==this.surveyId&&localStorage.clear(),localStorage.setItem("_formId",this.surveyId),localStorage.setItem("_instanceId",this.instance);var t=Se+this.instance+"/"+this.surveyId;f.a.get(t+"/fetch").then(function(t){e.updateData(t.data),e.setState({_rendered:!0})}).catch(function(t){console.log(t),j()("Oops!","Something went wrong!","error"),console.log(e.state)}),setTimeout(function(){e.setState({load:!0})},1e7)}},{key:"renderQuestions",value:function(){return r.a.createElement(ie,null)}},{key:"renderGroups",value:function(){return r.a.createElement(G,null)}},{key:"render",value:function(){return r.a.createElement("div",{className:this.state._fullscreen?"wrapper d-flex toggled":"wrapper d-flex"},r.a.createElement("div",{className:"sidebar-wrapper bg-light border-right"},r.a.createElement(me,null),this.state._rendered?this.renderGroups():"",1===this.props.value.questions.length?"":r.a.createElement(Oe,null)),r.a.createElement("div",{className:"page-content-wrapper"},r.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light border-bottom"},r.a.createElement("button",{className:"btn btn-primary",onClick:this.setFullscreen},this.state._fullscreen?r.a.createElement(R.b,null):r.a.createElement(R.a,null)),1===this.props.value.questions.length?"":r.a.createElement(U,null),r.a.createElement(ce,null)),r.a.createElement("div",{className:"container-fluid fixed-container",key:"div-group-"+this.state.surveyId},r.a.createElement(P,null),this.state._rendered?this.renderQuestions():"")))}}]),t}(n.Component),je=Object(v.b)(O,S)(ye),Ee=a(35),ke=a(66),Ie=a.n(ke),we={surveyName:"Loading..",surveyId:"Loading..",version:"Loading..",questions:[{group:1,heading:null,id:1,localeNameFlag:!1,mandatory:!1,order:1,show:!1,text:"Loading",type:"text",validation:!1}],active:[],answers:[],mandatory:[],submit:!1,captcha:!1,datapoint:null,datapoints:[],uuid:"LOADING",groups:{list:[{index:1,heading:"Loading Questions"}],active:1},pages:{},cascade:[]},Ce=function(e){if(Array.isArray(e))return e;var t=[];return"object"===typeof e&&t.push({index:0,heading:e.heading,question:e.question}),t},Ne=function(e){var t,a=function(e,t){return e.map(function(e){return function(e,t){return Object(m.a)({},e,{id:parseInt(e.id),order:parseInt(e.order),type:F(e),group:t.index+1,heading:t.heading,validation:!!e.validationRule&&e.validationRule,show:!1})}(e,t)})},n=Ce(e.questionGroup).map(function(e,t){return Object(m.a)({},e,{question:a(e.question,{heading:e.heading,index:t})})}).map(function(e){return e.question});return(t=[]).concat.apply(t,Object(L.a)(n))},xe=function(e){var t=Ce(e.questionGroup);return Ne(t).filter(function(e){return e.localeNameFlag}).map(function(e){return e.id})},Ae=function(e){return Ne(e).filter(function(e){return e.mandatory}).map(function(e){return e.id})},_e=function(e,t){var a=[];return e.map(function(e){var n=!0,r=!1;if(e.dependency&&(r=e.dependency,n=!1),r){var o;if(r["answer-value"].includes("|")>-1&&(o=(o=r["answer-value"].split("|")).map(function(e){return isNaN(e)||(e=parseInt(e)),e})),null!==localStorage.getItem(r.question)){var s=localStorage.getItem(r.question);Q(o)&&(s=JSON.parse(o)),isNaN(o)||(s=s.toString()),o.includes(s)&&(n=!0),s===o&&(n=!0)}null===localStorage.getItem(parseInt(r.question))&&(n=!1,localStorage.removeItem(e.id))}(t&&e.group!==t&&(n=!1),t||n)||(localStorage.removeItem(e.id),r&&!1===a.find(function(e){return parseInt(e.id)===parseInt(r.question)}).show&&(n=!1));return a.push(Object(m.a)({},e,{show:n,type:F(e)})),Object(m.a)({},e,{show:n,type:F(e)})})},Ge=function(e){return e},De=function(e,t,a){return e.map(function(e){var n=null;if(a){n=t.getItem(e.id)||null;try{n=JSON.parse(n)}catch(r){}n=parseInt(n).isNan?parseInt(n):n}return{id:e.id,answer:n,mandatory:e.mandatory}})},Pe=function(){var e=Ie()();return(e=(e=e.split("-")).map(function(e){return e.substring(0,4)}).slice(0,3)).join("-")},Re=function(e,t){var a=_e(t,!1).filter(function(e){return e.show});e=e.filter(function(e){return e.mandatory}).filter(function(e){return null!==e.answer});var n=a.map(function(t){var a=e.filter(function(e){return e.id===t.id}).map(function(e){return e.answer});return a=!(a.length<1),Object(m.a)({},t,{answered:a})}).filter(function(e){return e.mandatory});return n.filter(function(e){return e.answered}).length>=n.length},Te=function(e,t){return Object(m.a)({},e,{data:t})},Ue=Object(Ee.b)(function(){var e,t,a,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:we,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case"LOAD QUESTIONS":return Object(m.a)({},n,{surveyName:r.data.name,surveyId:r.data.surveyId,version:r.data.version,questions:Ne(r.data),datapoints:xe(r.data),groups:(a=r.data,{list:Ce(a.questionGroup).map(function(e,t){return{index:t+1,heading:e.heading}}),active:1}),mandatory:Ae(r.data)});case"RESTORE ANSWERS":return Object(m.a)({},n,{answers:De(r.data,localStorage,!0)});case"REDUCE ANSWER":return Object(m.a)({},n,{answers:De(n.answers,r.answer,!1)});case"REDUCE DATAPOINT":return Object(m.a)({},n,{datapoint:Ge(r.data)});case"CHANGE GROUP":return Object(m.a)({},n,{questions:_e(n.questions,r.group),groups:Object(m.a)({},n.groups,{active:r.group})});case"CHECK SUBMISSION":return Object(m.a)({},n,{captcha:Re(n.answers,n.questions),submit:!1});case"SUBMIT STATE":return Object(m.a)({},n,{submit:r.data});case"GENERATE UUID":return Object(m.a)({},n,{uuid:Pe(r.data)});case"PAGES SETTINGS":return Object(m.a)({},n,{pages:Te(n.pages,r.data)});case"STORE CASCADE":return Object(m.a)({},n,{cascade:(e=n.cascade,t=r.data,e.length<1?[t]:[].concat(Object(L.a)(e),[t]))});default:return n}}),qe=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(v.a,{store:Ue},r.a.createElement(h.a,null,r.a.createElement(p.a,{path:"/:instance/:surveyid",render:function(e){return r.a.createElement(je,Object.assign({key:"home"},e))}})))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(125);if(a(126).config(),localStorage.getItem("questionId")){var Le=localStorage.getItem("questionId").split(","),Fe=localStorage.getItem("answerType").split(","),Qe=Le.map(function(e,t){return{id:e,type:Fe[t]}}).filter(function(e){return"PHOTO"===e.type});Qe.length>0&&Qe.forEach(function(e){return localStorage.removeItem(e.id)})}s.a.render(r.a.createElement(qe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},42:function(e,t,a){},70:function(e,t,a){e.exports=a(129)}},[[70,1,2]]]);
//# sourceMappingURL=main.41fdc963.chunk.js.map