(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(e,t,a){},120:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(20),s=a.n(o),i=a(6),c=a(7),l=a(9),u=a(8),d=a(10),p=a(61),h=a(19),m=a(12),g=a(3),b=a(23),f=a.n(b),v=a(11),O=function(e){return{value:e}},S=function(e){return{loadQuestions:function(t){return e({type:"LOAD QUESTIONS",data:t})},changeGroup:function(t){return e({type:"CHANGE GROUP",group:t})},restoreAnswers:function(t){return e({type:"RESTORE ANSWERS",data:t})},reduceAnswer:function(t){return e({type:"REDUCE ANSWER",answer:t})},reduceDataPoint:function(t){return e({type:"REDUCE DATAPOINT",data:t})},checkSubmission:function(){return e({type:"CHECK SUBMISSION"})},submitState:function(t){return e({type:"SUBMIT STATE",data:t})},generateUUID:function(t){return e({type:"GENERATE UUID",data:t})},changeSettings:function(t){return e({type:"PAGES SETTINGS",data:t})}}},y=a(26),j=a.n(y),w=(a(33),a(99),a(55)),E=a(34),I=a(57),k=a.n(I);a(103);function C(){var e=Object(w.a)([" margin: 0 auto; border-color: red; "]);return C=function(){return e},e}var N=Object(E.css)(C()),x=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={color:"#007bff"},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:this.props.styles},r.a.createElement("h3",{className:"mt-2"},"Loading Forms"),r.a.createElement(k.a,{css:N,sizeUnit:"px",size:20,color:this.state.color}))}}]),t}(r.a.Component),_=Object(v.b)(O,S)(x),G=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).getUrl=function(e){return"#"+e.replace(/ /g,"-").toLowerCase()},a.getLoading=function(){return r.a.createElement(_,{styles:"sidebar-loading"})},a.showQuestion=a.showQuestion.bind(Object(g.a)(a)),a.getQuestionList=a.getQuestionList.bind(Object(g.a)(a)),a.listClass="list-group-item list-group-item-action ",a.getUrl=a.getUrl.bind(Object(g.a)(a)),a.state={_showQuestion:""},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"showQuestion",value:function(e){this.props.changeGroup(e)}},{key:"componentDidMount",value:function(){}},{key:"getQuestionList",value:function(e){var t=this;return e.list.map(function(a){return r.a.createElement("div",{className:"list-group list-group-flush",key:"group-"+a.index},r.a.createElement("a",{onClick:function(){t.showQuestion(a.index)},href:t.getUrl(a.heading),className:a.index===e.active?t.listClass+" bg-current":t.listClass+" bg-light"},a.heading))})}},{key:"render",value:function(){return 1===this.props.value.questions.length?this.getLoading():this.getQuestionList(this.props.value.groups)}}]),t}(n.Component),D=Object(v.b)(O,S)(G),P=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).getHeader=function(e){return e.list.filter(function(t){return t.index===e.active}).map(function(e){return r.a.createElement(n.Fragment,{key:e.index},r.a.createElement("h2",{className:"mt-2"},e.heading),r.a.createElement("p",null,e.heading))})},a.getLoading=function(){return r.a.createElement(_,{styles:"header-loading"})},a.getHeader=a.getHeader.bind(Object(g.a)(a)),a.getLoading=a.getLoading.bind(Object(g.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return 1===this.props.value.questions.length?this.getLoading():this.getHeader(this.props.value.groups)}}]),t}(n.Component),R=Object(v.b)(O)(P),q=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"data-point"},r.a.createElement("h3",{className:"data-point-name"},this.props.value.datapoint),r.a.createElement("span",{className:"text-center data-point-id"},this.props.value.uuid))}}]),t}(n.Component),A=Object(v.b)(O)(q),U=a(24),Q=a(30),T=function(e){var t=e.type;switch(e.validationRule&&(t="numeric"===e.validationRule.validationType?"number":"text"),e.options&&(t="option"),t){case"signature":break;case"photo":return"photo";case"number":return"number";case"option":return"option";case"cascade":return"cascade";case"geo":return"text";case"date":return"date";default:return"text"}return t},F=function(e){try{JSON.parse(e)}catch(t){return!1}return!0},L=a(36),J=a(58),M=a.n(J),H=(a(105),"https://2scale.tc.akvotest.org/akvo-flow-web-api/"),W=2;Object(L.registerPlugin)(M.a);var z=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).instanceUrl=window.location.pathname.split("/")[W],a.value=localStorage.getItem(a.props.data.id),a.state={value:a.value?a.value:""},a.setDpStorage=a.setDpStorage.bind(Object(g.a)(a)),a.getRadioSelected=a.getRadio.bind(Object(g.a)(a)),a.getPhoto=a.getPhoto.bind(Object(g.a)(a)),a.renderRadio=a.renderRadio.bind(Object(g.a)(a)),a.getCascadeDropdown=a.getCascadeDropdown.bind(Object(g.a)(a)),a.renderCascade=a.renderCascade.bind(Object(g.a)(a)),a.renderCascadeOption=a.renderCascadeOption.bind(Object(g.a)(a)),a.limitCascade=0,a.handleChange=a.handleChange.bind(Object(g.a)(a)),a.handlePhoto=a.handlePhoto.bind(Object(g.a)(a)),a.handleCascadeChange=a.handleCascadeChange.bind(Object(g.a)(a)),a.handleGlobal=a.handleGlobal.bind(Object(g.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"handleGlobal",value:function(e,t){this.props.restoreAnswers(this.props.value.questions),this.props.changeGroup(this.props.value.groups.active),this.props.checkSubmission()}},{key:"handleCascadeChange",value:function(e,t,a,n){var r,o={id:e,text:t,option:parseInt(n)};if(localStorage.getItem(a)){var s=JSON.parse(localStorage.getItem(a)).filter(function(t){return t.id<e});r=JSON.stringify([].concat(Object(Q.a)(s),[o]))}else r=JSON.stringify([o]);return 0!==e&&(localStorage.setItem(this.props.data.id,r),this.handleGlobal(this.props.data.id,r)),!0}},{key:"handlePhoto",value:function(e){var t=this.props.data.id;localStorage.setItem(t,e),this.setState({value:e}),this.handleGlobal(t,e)}},{key:"handleChange",value:function(e){var t=this.props.data.id,a=e.target.value;if("cascade"===this.props.data.type){var n=e.target.selectedIndex,r=e.target[n].text,o=parseInt(e.target.name.split("-")[1])+1;this.handleCascadeChange(o,r,t,a),this.limitCascade>o&&this.getCascadeDropdown(a,o)}else if(this.props.data.options&&this.props.data.options.allowMultiple){var s=[];localStorage.getItem(t)&&(s=JSON.parse(localStorage.getItem(t))),-1===s.indexOf(a)?s.push(a):s.splice(s.indexOf(a),1),s.length>0?(localStorage.setItem(t,JSON.stringify(s)),this.setState({value:s}),this.handleGlobal(t,a)):(localStorage.removeItem(t),this.setState({value:""}))}else localStorage.setItem(t,a),this.setState({value:a}),this.handleGlobal(t,a);if(""===a&&(this.setState({value:a}),localStorage.removeItem(t),this.handleGlobal(t,a)),this.props.data.localeNameFlag){var i=JSON.parse(localStorage.getItem("_dpOrder")),c=[];i.map(function(e){var t=localStorage.getItem(e);t&&(F(t)&&isNaN(t)?JSON.parse(t).map(function(e){return e.text}).forEach(function(e){c.push(e)}):c.push(t));return!0});var l=c.join(" - ");localStorage.setItem("_dataPointName",l),this.props.reduceDataPoint(localStorage.getItem("_dataPointName"))}}},{key:"setDpStorage",value:function(){if(localStorage.getItem("_dpOrder")){var e=JSON.parse(localStorage.getItem("_dpOrder"));e.includes(this.props.data.id)||e.push(this.props.data.id),localStorage.setItem("_dpOrder",JSON.stringify(e))}else localStorage.setItem("_dpOrder",JSON.stringify([this.props.data.id]))}},{key:"getRadio",value:function(e,t){var a=this,n=e.options,r=n.allowMultiple?"checkbox":"radio";return n.option.length>1?n.option.map(function(n,o){return a.renderRadio(n,o,e.id,r,t)}):this.renderRadio(n.option,0,e.id,r,t)}},{key:"getRadioSelected",value:function(e,t){return!!localStorage.getItem(t)&&localStorage.getItem(t)===e}},{key:"renderRadio",value:function(e,t,a,n,o){var s=function(){return localStorage.getItem(a)===e.value};return"checkbox"===n&&this.state.value.indexOf(e.value)>=0&&(s=function(){return!0}),r.a.createElement("div",{className:"form-check",key:o+"-div-radio-"+t.toString()},r.a.createElement("input",{key:o+"-radio-"+t.toString(),className:"form-check-input",type:n,name:a,value:e.value,onChange:this.handleChange,checked:s()}),r.a.createElement("label",{className:"form-check-label",htmlFor:"input-"+(a+t).toString()},e.text))}},{key:"getCascade",value:function(e,t,a){var n=this,r=e.levels.level.length-1;return e.levels.level.map(function(e,t){return n.limitCascade=t+1,n.renderCascade(e,t,r,a)})}},{key:"renderCascade",value:function(e,t,a,n){var o=[],s="cascade_"+t,i=this.state[this.state[s]],c=r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,e.text),r.a.createElement("select",{className:"form-control",value:this.state.selected,type:"select",name:this.props.data.id.toString()+"-"+t,onChange:this.handleChange},r.a.createElement("option",{key:n+"-cascade-options-0",value:"0",selected:!0},"Please Select"),this.renderCascadeOption(i,t+1,e.text,n)));return o.push(c),this.limitCascade<=t&&this.handleChange(),o.map(function(e,t){return e})}},{key:"renderCascadeOption",value:function(e,t,a){if(e)return e.map(function(e,t){return r.a.createElement("option",{key:a+"-cascade-options-"+t,value:e.id},e.name)})}},{key:"getCascadeDropdown",value:function(e,t){var a=this;if("cascade"===this.props.data.type){var n=this.instanceUrl;n=H+"cascade/"+n+"/"+this.props.data.cascadeResource+"/"+e;var r="options_"+e,o="cascade_"+t;f.a.get(n).then(function(e){try{var n;a.setState((n={},Object(U.a)(n,r,e.data),Object(U.a)(n,o,[r]),Object(U.a)(n,"value",e.data[t].id),n))}catch(s){localStorage.removeItem(a.props.data.id)}return e}).then(function(n){var r=a.props.data.levels.level.length;e<r&&null===localStorage.getItem(a.props.data.id)&&a.handleCascadeChange(t,n.data[t].name,a.props.data.id,n.data[t].id)})}}},{key:"getInput",value:function(e,t,a,n,o){return r.a.createElement("input",{className:"photo"===e.type?"form-control-file":"form-control",value:n||"",min:a.minVal?a.minVal:"",max:a.maxVal?a.maxVal:"",key:t,type:o,name:"Q-"+e.id.toString(),onChange:this.handleChange})}},{key:"getInputOther",value:function(e,t,a,n){return r.a.createElement("input",{className:"photo"===e.type?"form-control-file":"form-control",value:a||"",key:t,type:n,name:"Q-"+e.id.toString(),onChange:this.handleChange})}},{key:"getPhoto",value:function(e,t,a,n){var o=this;return r.a.createElement(L.FilePond,{key:t,allowMultiple:!1,name:"Q-"+e.id.toString(),"data-max-file-size":"500kb",server:H+"upload-image",onprocessfile:function(e,t){o.handlePhoto(t.serverId)}})}},{key:"getTextArea",value:function(e,t,a,n){return r.a.createElement("textarea",{key:t,rows:"3",className:"form-control",value:a||"",type:n,onChange:this.handleChange,name:"Q-"+e.id.toString()})}},{key:"componentDidMount",value:function(){"cascade"===this.props.data.type&&(localStorage.removeItem(this.props.data.id),this.getCascadeDropdown(0,0)),this.props.checkSubmission()}},{key:"render",value:function(){var e=this.props.data,t="question-form-"+e.id.toString(),a=e.type,n=localStorage.getItem(e.id);switch(e.localeNameFlag&&this.setDpStorage(),a){case"option":return this.getRadio(e,t);case"cascade":return this.getCascade(e,0,t);case"number":return this.getInput(e,t,e.validationRule,n,a);case"photo":return this.getPhoto(e,t,n,"file");case"date":return this.getInputOther(e,t,n,a);default:return this.getTextArea(e,t,n,a)}}}]),t}(n.Component),B=Object(v.b)(O,S)(z),V=a(25),K=a(121),Z=a(122),$=a(123),X=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).getForms=a.getForms.bind(Object(g.a)(a)),a.isJsonString=a.isJsonString.bind(Object(g.a)(a)),a.renderMandatoryIcon=a.renderMandatoryIcon.bind(Object(g.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"isJsonString",value:function(e){try{JSON.parse(e)}catch(t){return!1}return!0}},{key:"renderMandatoryIcon",value:function(e){var t=!1;return localStorage.getItem(e)&&(t=!0),function(e){return e?r.a.createElement(V.c,{color:"green",className:"float-right"}):r.a.createElement(V.d,{color:"red",className:"float-right"})}(t)}},{key:"getForms",value:function(e){var t=this;return e.map(function(e){var a=e.id.toString();return r.a.createElement(K.a,{key:"card-"+a,className:!1===e.show?"d-none":""},r.a.createElement(Z.a,{key:"card-body-"+a,id:"card-body-"+a},r.a.createElement($.a,{key:"card-title-"+a},e.order.toString()+". "+e.text,e.mandatory?t.renderMandatoryIcon(a):""),r.a.createElement(B,{key:"question-type-"+a,data:e})))})}},{key:"render",value:function(){return this.getForms(this.props.value.questions)}}]),t}(n.Component),Y=Object(v.b)(O)(X),ee=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).showQuestion=a.showQuestion.bind(Object(g.a)(a)),a.state={_showQuestion:""},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"showQuestion",value:function(e){this.props.onSelectGroup(e),this.setState({_showQuestion:e,_prevDisable:!(this.props.data.prev<=0),_nextDisable:this.props.data.next!==this.props.data.total})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"btn btn-group ml-auto mt-2 mt-lg-0"},r.a.createElement("button",{className:"btn "+(!1===this.state._prevDisable?"btn-secondary":"btn-primary"),onClick:function(){e.showQuestion(e.props.data.prev)}},"Prev"),r.a.createElement("button",{className:"btn "+(!1===this.state._nextDisable?"btn-secondary":"btn-primary"),onClick:function(){e.showQuestion(e.props.data.next)}},"Next"))}}]),t}(n.Component),te=a(127),ae=a(124),ne=a(125),re=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"sidebar-heading"},r.a.createElement("div",{className:"my-2"},r.a.createElement(te.a,null,r.a.createElement(ae.a,null,r.a.createElement("img",{alt:"img-logo",src:"https://www.2scale.org/assets/default/img/logo_2scale_red.gif",className:"responsive-image"}),this.props.value.surveyName),r.a.createElement(ne.a,null,"Survey ID: ",this.props.value.surveyId,r.a.createElement("br",null),"Version: ",this.props.value.version))))}}]),t}(n.Component),oe=Object(v.b)(O)(re),se=a(63),ie=a(126),ce="6Lejm74UAAAAAA6HkQwn6rkZ7mxGwIjOx_vgNzWC",le=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleCaptcha=function(e){a.setState({captcha:e}),a.props.submitState(!0),null===a.state.captcha&&a.setState({expired:!0})},a.asyncScriptOnLoad=function(){a.setState({callback:"called!"})},a.showCaptcha=function(){return r.a.createElement(se.a,{style:{display:"block",overflow:"hidden",borderBottom:"1px solid #ddd",padding:"8px"},size:"normal",theme:"light",ref:a._reCaptchaRef,sitekey:ce,onChange:a.handleCaptcha,asyncScriptOnLoad:a.asyncScriptOnLoad})},a.showPassword=function(){return r.a.createElement(n.Fragment,null,r.a.createElement("label",{className:"form-password-label",htmlFor:"submit-password"},"Password:"),r.a.createElement("input",{className:"form-control",type:"password",name:"submit-password",onChange:a.handlePassword}),r.a.createElement("hr",null))},a.showSpinner=function(e){return r.a.createElement(ie.a,{size:"sm",color:"light"})},a.showCaptcha=a.showCaptcha.bind(Object(g.a)(a)),a.showPassword=a.showPassword.bind(Object(g.a)(a)),a.submitForm=a.submitForm.bind(Object(g.a)(a)),a.handleCaptcha=a.handleCaptcha.bind(Object(g.a)(a)),a.handlePassword=a.handlePassword.bind(Object(g.a)(a)),a.showSpinner=a.showSpinner.bind(Object(g.a)(a)),a.state={_showCaptcha:a.props.value.captcha,_showSpinner:!1},a._reCaptchaRef=r.a.createRef(),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"handlePassword",value:function(e){console.log(e.target.value),localStorage.setItem("_password",e.target.value)}},{key:"submitForm",value:function(){var e=this;localStorage.setItem("_submissionStop",Date.now()),this.setState({_showSpinner:!0}),f.a.post("https://2scale.tc.akvotest.org/akvo-flow-web-api/submit-form",localStorage).then(function(t){return e.setState({_showSpinner:!1}),j()("Success!","New datapoint is sent!","success"),t}).catch(function(t,a){console.log(t,a),e.setState({_showSpinner:!1}),j()("Failed!","Something Wrong!","error")})}},{key:"render",value:function(){return r.a.createElement(n.Fragment,null,!!this.props.value.captcha&&this.showCaptcha(),r.a.createElement("div",{className:"submit-block"},!!this.props.value.submit&&this.showPassword(),r.a.createElement("button",{onClick:this.submitForm,className:"btn btn-block btn-"+(this.props.value.submit?"primary":"secondary"),disabled:!this.props.value.submit},this.state._showSpinner?r.a.createElement(ie.a,{size:"sm",color:"light"}):"",r.a.createElement("span",null,"Submit"))))}}]),t}(n.Component),ue=Object(v.b)(O,S)(le),de=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).updateData=function(e){a.props.loadQuestions(e),a.props.restoreAnswers(a.props.value.questions),localStorage.getItem("_dataPointName")&&a.props.reduceDataPoint(localStorage.getItem("_dataPointName")),a.props.changeGroup(1),localStorage.setItem("_version",e.version),localStorage.setItem("_instanceId",e.app);var t=[],n=[];Array.isArray(e.questionGroup)||(e.questionGroup=[e.questionGroup]),e.questionGroup.forEach(function(e){e.question.forEach(function(e,a){t.push(e.id),n.push(e.type.toUpperCase())})}),localStorage.setItem("questionId",t),localStorage.setItem("answerType",n),a.setState(Object(m.a)({},e,{_nextGroup:e.questionGroup.length>=1?0:1,_currentGroup:0,_prevGroup:0,_totalGroup:e.questionGroup.length}));var r=[Math.random().toString(36).slice(2).substring(1,5),Math.random().toString(36).slice(2).substring(1,5),Math.random().toString(36).slice(2).substring(1,5)];localStorage.setItem("_dataPointId",r.join("-")),localStorage.setItem("_submissionStart",Date.now()),localStorage.setItem("_deviceId","Deden Flow Support")},a.updateQuestions=function(e){a.setState({questionIndex:e})},a.selectGroup=function(){a.setState({_prevGroup:!1,_nextGroup:!0})},a.instance=a.props.match.params.instance,a.surveyId=a.props.match.params.surveyid,a.setFullscreen=a.setFullscreen.bind(Object(g.a)(a)),a.selectGroup=a.selectGroup.bind(Object(g.a)(a)),a.state={_fullScreen:!1,_prevGroup:!1,_nextGroup:!0,_totalGroup:a.props.value.groups.length},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"setFullscreen",value:function(){var e=this.state._fullscreen;this.setState({_fullscreen:!e})}},{key:"componentDidMount",value:function(){var e=this;this.props.generateUUID({}),this.props.changeSettings({_isLoading:!0}),localStorage.setItem("_formId",this.surveyId),localStorage.setItem("_instanceId",this.instance),f.a.get("https://2scale.tc.akvo.org/akvo-flow-web-api/"+this.instance+"/"+this.surveyId+"/update").then(function(t){e.updateData(t.data)}).catch(function(t){console.log(t),j()("Oops!","Something went wrong!","error"),console.log(e.state)}),setTimeout(function(){e.setState({load:!0})},1e7)}},{key:"render",value:function(){return r.a.createElement("div",{className:this.state._fullscreen?"wrapper d-flex toggled":"wrapper d-flex"},r.a.createElement("div",{className:"sidebar-wrapper bg-light border-right"},r.a.createElement(oe,null),r.a.createElement(D,null),1===this.props.value.questions.length?"":r.a.createElement(ue,null)),r.a.createElement("div",{className:"page-content-wrapper"},r.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light border-bottom"},r.a.createElement("button",{className:"btn btn-primary",onClick:this.setFullscreen},this.state._fullscreen?r.a.createElement(V.b,null):r.a.createElement(V.a,null)),1===this.props.value.questions.length?"":r.a.createElement(A,null),r.a.createElement(ee,{onSelectGroup:this.selectGroup,data:{prev:this.state._prevGroup,total:this.state._totalGroup,next:this.state._nextGroup}})),r.a.createElement("div",{className:"container-fluid fixed-container",key:"div-group-"+this.state.surveyId},r.a.createElement(R,null),r.a.createElement(Y,null))))}}]),t}(n.Component),pe=Object(v.b)(O,S)(de),he=a(29),me=a(60),ge=a.n(me),be={surveyName:"Loading..",surveyId:"Loading..",version:"Loading..",questions:[{group:1,heading:null,id:1,localeNameFlag:!1,mandatory:!1,order:1,show:!1,text:"Loading",type:"text",validation:!1}],active:[],answers:[],mandatory:[],submit:!1,captcha:!1,datapoint:null,datapoints:[],uuid:"LOADING",groups:{list:[{index:1,heading:"Loading Questions"}],active:1},pages:{}},fe=function(e){var t,a=function(e,t){return e.map(function(e){return function(e,t){return Object(m.a)({},e,{id:parseInt(e.id),order:parseInt(e.order),type:T(e),group:t.index+1,heading:t.heading,validation:!!e.validationRule&&e.validationRule,show:!1})}(e,t)})},n=e.questionGroup.map(function(e,t){return Object(m.a)({},e,{question:a(e.question,{heading:e.heading,index:t})})}).map(function(e){return e.question});return(t=[]).concat.apply(t,Object(Q.a)(n))},ve=function(e){return{list:e.questionGroup.map(function(e,t){return{index:t+1,heading:e.heading}}),active:1}},Oe=function(e){return fe(e).filter(function(e){return e.mandatory}).map(function(e){return e.id})},Se=function(e,t){var a=[];return e.map(function(e){var n=!0,r=!1;if(e.dependency&&(r=e.dependency,n=!1),r){var o;if(r["answer-value"].includes("|")>-1&&(o=(o=r["answer-value"].split("|")).map(function(e){return isNaN(e)||(e=parseInt(e)),e})),null!==localStorage.getItem(r.question)){var s=localStorage.getItem(r.question);F(o)&&(s=JSON.parse(o)),isNaN(o)||(s=s.toString()),o.includes(s)&&(n=!0),s===o&&(n=!0)}null===localStorage.getItem(parseInt(r.question))&&(n=!1,localStorage.removeItem(e.id))}(t&&e.group!==t&&(n=!1),t||n||localStorage.removeItem(e.id),r)&&(!1===a.find(function(e){return parseInt(e.id)===parseInt(r.question)}).show&&(n=!1));return a.push(Object(m.a)({},e,{show:n,type:T(e)})),Object(m.a)({},e,{show:n,type:T(e)})})},ye=function(e){return e},je=function(e,t,a){return e.map(function(e){var n=null;if(a){n=t.getItem(e.id)||null;try{n=JSON.parse(n)}catch(r){}n=parseInt(n).isNan?parseInt(n):n}return{id:e.id,answer:n,mandatory:e.mandatory}})},we=function(){var e=ge()();return(e=(e=e.split("-")).map(function(e){return e.substring(0,4)}).slice(0,3)).join("-")},Ee=function(e,t){var a=Se(t,!1).filter(function(e){return e.show});e=e.filter(function(e){return e.mandatory}).filter(function(e){return null!==e.answer});var n=a.map(function(t){var a=e.filter(function(e){return e.id===t.id}).map(function(e){return e.answer});return a=!(a.length<1),Object(m.a)({},t,{answered:a})}).filter(function(e){return e.mandatory});return n.filter(function(e){return e.answered}).length>=n.length},Ie=function(e,t){return Object(m.a)({},e,{data:t})},ke=Object(he.b)(function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"LOAD QUESTIONS":return Object(m.a)({},t,{surveyName:a.data.name,surveyId:a.data.surveyId,version:a.data.version,questions:fe(a.data),datapoints:(e=a.data,fe(e).filter(function(e){return e.localeNameFlag}).map(function(e){return e.id})),groups:ve(a.data),mandatory:Oe(a.data)});case"RESTORE ANSWERS":return Object(m.a)({},t,{answers:je(a.data,localStorage,!0)});case"REDUCE ANSWER":return Object(m.a)({},t,{answers:je(t.answers,a.answer,!1)});case"REDUCE DATAPOINT":return Object(m.a)({},t,{datapoint:ye(a.data)});case"CHANGE GROUP":return Object(m.a)({},t,{questions:Se(t.questions,a.group),groups:Object(m.a)({},t.groups,{active:a.group})});case"CHECK SUBMISSION":return Object(m.a)({},t,{captcha:Ee(t.answers,t.questions)});case"SUBMIT STATE":return Object(m.a)({},t,{submit:a.data});case"GENERATE UUID":return Object(m.a)({},t,{uuid:we(a.data)});case"PAGES SETTINGS":return Object(m.a)({},t,{pages:Ie(t.pages,a.data)});default:return t}}),Ce=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(v.a,{store:ke},r.a.createElement(p.a,null,r.a.createElement(h.a,{path:"/akvo-flow-web/:instance/:surveyid",render:function(e){return r.a.createElement(pe,Object.assign({key:"home"},e))}})))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(116);if(a(117).config(),localStorage.getItem("questionId")){var Ne=localStorage.getItem("questionId").split(","),xe=localStorage.getItem("answerType").split(","),_e=Ne.map(function(e,t){return{id:e,type:xe[t]}}).filter(function(e){return"PHOTO"===e.type});_e.length>0&&_e.forEach(function(e){return localStorage.removeItem(e.id)})}s.a.render(r.a.createElement(Ce,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},33:function(e,t,a){},64:function(e,t,a){e.exports=a(120)}},[[64,1,2]]]);
//# sourceMappingURL=main.3cb96d21.chunk.js.map