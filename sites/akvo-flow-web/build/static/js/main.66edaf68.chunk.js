(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,a){},117:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(21),i=a.n(o),s=a(6),c=a(7),l=a(10),u=a(8),d=a(11),p=a(58),h=a(20),m=a(13),g=a(3),f=a(24),b=a.n(f),v=a(9),O=function(e){return{value:e}},y=function(e){return{loadQuestions:function(t){return e({type:"LOAD QUESTIONS",data:t})},changeGroup:function(t){return e({type:"CHANGE GROUP",group:t})},restoreAnswers:function(t){return e({type:"RESTORE ANSWERS",data:t})},reduceAnswer:function(t){return e({type:"REDUCE ANSWER",answer:t})},reduceDataPoint:function(t){return e({type:"REDUCE DATAPOINT",data:t})},checkSubmission:function(){return e({type:"CHECK SUBMISSION"})},submitState:function(t){return e({type:"SUBMIT STATE",data:t})},generateUUID:function(t){return e({type:"GENERATE UUID",data:t})},changeSettings:function(t){return e({type:"PAGES SETTINGS",data:t})},storeCascade:function(t){return e({type:"STORE CASCADE",data:t})}}},S=a(25),j=a.n(S),w=(a(33),a(96),a(54)),E=a(34),I=a(55),k=a.n(I);a(100);function C(){var e=Object(w.a)([" margin: 0 auto; border-color: red; "]);return C=function(){return e},e}var N=Object(E.css)(C()),P=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={color:"#007bff"},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:this.props.styles},r.a.createElement("h3",{className:"mt-2"},"Loading Forms"),r.a.createElement(k.a,{css:N,sizeUnit:"px",size:20,color:this.state.color}))}}]),t}(r.a.Component),x=Object(v.b)(O,y)(P),_=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).getUrl=function(e){return"#"+e.replace(/ /g,"-").toLowerCase()},a.getLoading=function(){return r.a.createElement(x,{styles:"sidebar-loading"})},a.showQuestion=a.showQuestion.bind(Object(g.a)(a)),a.getQuestionList=a.getQuestionList.bind(Object(g.a)(a)),a.listClass="list-group-item list-group-item-action ",a.getUrl=a.getUrl.bind(Object(g.a)(a)),a.state={_showQuestion:""},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"showQuestion",value:function(e){this.props.changeGroup(e)}},{key:"componentDidMount",value:function(){}},{key:"getQuestionList",value:function(e){var t=this;return e.list.map(function(a){return r.a.createElement("div",{className:"list-group list-group-flush",key:"group-"+a.index},r.a.createElement("a",{onClick:function(){t.showQuestion(a.index)},href:t.getUrl(a.heading),className:a.index===e.active?t.listClass+" bg-current":t.listClass+" bg-light"},a.heading))})}},{key:"render",value:function(){return 1===this.props.value.questions.length?this.getLoading():this.getQuestionList(this.props.value.groups)}}]),t}(n.Component),D=Object(v.b)(O,y)(_),A=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).getHeader=function(e){return e.list.filter(function(t){return t.index===e.active}).map(function(e){return r.a.createElement(n.Fragment,{key:e.index},r.a.createElement("h2",{className:"mt-2"},e.heading),r.a.createElement("p",null,e.heading))})},a.getLoading=function(){return r.a.createElement(x,{styles:"header-loading"})},a.getHeader=a.getHeader.bind(Object(g.a)(a)),a.getLoading=a.getLoading.bind(Object(g.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return 1===this.props.value.questions.length?this.getLoading():this.getHeader(this.props.value.groups)}}]),t}(n.Component),G=Object(v.b)(O)(A),R=a(19),q=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:"data-point"},r.a.createElement("h3",{className:"data-point-name"},r.a.createElement(R.e,{color:"#9ea4a8",className:"data-point-icon"}),this.props.value.datapoint),r.a.createElement("span",{className:"data-point-id"},this.props.value.uuid)))}}]),t}(n.Component),T=Object(v.b)(O)(q),U=a(23),F=function(e){var t=e.type;switch(e.validationRule&&(t="numeric"===e.validationRule.validationType?"number":"text"),e.options&&(t="option"),t){case"signature":break;case"photo":return"photo";case"number":return"number";case"option":return"option";case"cascade":return"cascade";case"geo":return"text";case"date":return"date";default:return"text"}return t},Q=function(e){try{JSON.parse(e)}catch(t){return!1}return!0},L=a(36),J=a(56),M=a.n(J);a(102);function H(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}var W="https://2scale.tc.akvo.org/akvo-flow-web-api/",z=2;Object(L.registerPlugin)(M.a);var B=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).instanceUrl=window.location.pathname.split("/")[z],a.value=localStorage.getItem(a.props.data.id),a.other=localStorage.getItem("other_"+a.props.data.id),a.state={value:a.value?a.value:"",other:a.other?a.other:""},a.setDpStorage=a.setDpStorage.bind(Object(g.a)(a)),a.getRadio=a.getRadio.bind(Object(g.a)(a)),a.getPhoto=a.getPhoto.bind(Object(g.a)(a)),a.renderRadio=a.renderRadio.bind(Object(g.a)(a)),a.getCascadeDropdown=a.getCascadeDropdown.bind(Object(g.a)(a)),a.renderCascade=a.renderCascade.bind(Object(g.a)(a)),a.renderCascadeOption=a.renderCascadeOption.bind(Object(g.a)(a)),a.fetchCascade=a.fetchCascade.bind(Object(g.a)(a)),a.limitCascade=0,a.handleChange=a.handleChange.bind(Object(g.a)(a)),a.handleOther=a.handleOther.bind(Object(g.a)(a)),a.handlePhoto=a.handlePhoto.bind(Object(g.a)(a)),a.handleCascadeChange=a.handleCascadeChange.bind(Object(g.a)(a)),a.handleGlobal=a.handleGlobal.bind(Object(g.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"handleGlobal",value:function(e,t){this.props.restoreAnswers(this.props.value.questions),this.props.changeGroup(this.props.value.groups.active),this.props.checkSubmission()}},{key:"handleCascadeChange",value:function(e,t,a,n){var r,o={id:e,text:t,option:parseInt(n)};if(localStorage.getItem(a)){var i=JSON.parse(localStorage.getItem(a)).filter(function(t){return t.id<e});r=JSON.stringify([].concat(Object(U.a)(i),[o]))}else r=JSON.stringify([o]);return 0!==e&&(localStorage.setItem(this.props.data.id,r),this.handleGlobal(this.props.data.id,r)),!0}},{key:"handlePhoto",value:function(e){var t=this.props.data.id;localStorage.setItem(t,e),this.setState({value:e}),this.handleGlobal(t,e)}},{key:"handleChange",value:function(e){var t=this.props.data.id,a=e.target.value,n=e.target.id;if(n.split("_")[0])return this.handleOther(n,a);if("cascade"===this.props.data.type){var r=e.target.selectedIndex,o=e.target[r].text,i=parseInt(e.target.name.split("-")[1])+1;this.handleCascadeChange(i,o,t,a),this.limitCascade>i&&this.getCascadeDropdown(a,i)}else if(this.props.data.options&&this.props.data.options.allowMultiple){var s=[];if(localStorage.getItem(t)&&(s=JSON.parse(localStorage.getItem(t))),-1===s.indexOf(a)?s.push(a):s.splice(s.indexOf(a),1),s.length>0?(localStorage.setItem(t,JSON.stringify(s)),this.setState({value:s}),this.handleGlobal(t,a)):(localStorage.removeItem(t),this.setState({value:""})),this.props.data.options.allowOther){if("Other Option"===a&&e.target.checked){var c="other_"+this.props.data.id.toString();this.setState(Object(m.a)({},c,!0))}if("Other Option"===a&&!e.target.checked){var l="other_"+this.props.data.id.toString();this.setState(Object(m.a)({},l,!1))}}this.handleGlobal(t,a)}else localStorage.setItem(t,a),this.setState({value:a}),this.handleGlobal(t,a);if(""===a&&(this.setState({value:a}),localStorage.removeItem(t),this.handleGlobal(t,a)),this.props.data.localeNameFlag){var u=JSON.parse(localStorage.getItem("_dpOrder")),d=[];u.map(function(e){var t=localStorage.getItem(e);t&&(Q(t)&&isNaN(t)?JSON.parse(t).map(function(e){return e.text}).forEach(function(e){d.push(e)}):d.push(t));return!0});var p=d.join(" - ");localStorage.setItem("_dataPointName",p),this.props.reduceDataPoint(localStorage.getItem("_dataPointName"))}}},{key:"handleOther",value:function(e,t){var a="";localStorage.getItem(e)&&(a=localStorage.getItem(e)),a=t,localStorage.setItem(e,a),this.setState({other:a})}},{key:"setDpStorage",value:function(){if(localStorage.getItem("_dpOrder")){var e=JSON.parse(localStorage.getItem("_dpOrder"));e.includes(this.props.data.id)||e.push(this.props.data.id),localStorage.setItem("_dpOrder",JSON.stringify(e))}else localStorage.setItem("_dpOrder",JSON.stringify([this.props.data.id]))}},{key:"getRadio",value:function(e,t){var a=this,n=e.options;void 0===n.allowMultiple&&(n=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?H(a,!0).forEach(function(t){Object(m.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):H(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},n,{allowMultiple:!1}));var r=n.allowMultiple?"checkbox":"radio";if(n.allowOther){if(n.option.length>1){var o=n.option.length+1,i=n.option.map(function(n,o){return a.renderRadio(!1,n,o,e.id,r,t)}),s=this.renderRadio(!0,{text:"Other",value:"Other Option"},o,e.id,r,t);return[].concat(Object(U.a)(i),[s])}var c=this.renderRadio(!1,n.option,0,e.id,r,t),l=this.renderRadio(!0,{text:"Other",value:"Other Option"},1,e.id,r,t);return[].concat(Object(U.a)(c),[l])}return n.option.length>1?n.option.map(function(n,o){return a.renderRadio(!1,n,o,e.id,r,t)}):this.renderRadio(!1,n.option,0,e.id,r,t)}},{key:"renderRadio",value:function(e,t,a,n,o,i){var s=function(){return localStorage.getItem(n)===t.value};if("checkbox"===o&&this.state.value.indexOf(t.value)>=0&&(s=function(){return!0}),e){var c="other_"+n.toString();return r.a.createElement("div",{key:i+"-div-radio-"+a.toString()},r.a.createElement("div",{className:"form-check"},r.a.createElement("input",{key:i+"-radio-"+a.toString(),className:"form-check-input",type:o,name:n,value:t.value,onChange:this.handleChange,checked:s()}),r.a.createElement("label",{className:"form-check-label badge badge-secondary",htmlFor:"input-"+n.toString()},t.text)),r.a.createElement("hr",null),r.a.createElement("div",{className:s()?"":"hidden"},r.a.createElement("label",{className:"form-label",htmlFor:c},"Other Answer:"),r.a.createElement("input",{className:"form-control",key:i+"-radio-other-"+a.toString(),value:this.state.other,type:"text",name:c,id:c,onChange:this.handleChange})))}return r.a.createElement("div",{className:"form-check",key:i+"-div-radio-"+a.toString()},r.a.createElement("input",{key:i+"-radio-"+a.toString(),className:"form-check-input",type:o,name:n,value:t.value,onChange:this.handleChange,checked:s()}),r.a.createElement("label",{className:"form-check-label",htmlFor:"input-"+(n+a).toString()},t.text))}},{key:"getCascade",value:function(e,t,a){var n=this;if(Array.isArray(e.levels.level)){var r=e.levels.level.length-1;return e.levels.level.map(function(e,t){return n.limitCascade=t+1,n.renderCascade(e,t,r,a)})}return this.limitCascade=1,this.renderCascade(e.levels.level,0,0,a)}},{key:"renderCascade",value:function(e,t,a,n){var o=[],i="cascade_"+t,s=this.state[this.state[i]],c=r.a.createElement("div",{key:n+"-dropdown-"+t},r.a.createElement("div",null,e.text),r.a.createElement("select",{className:"form-control",value:this.state.selected,type:"select",name:this.props.data.id.toString()+"-"+t,onChange:this.handleChange},r.a.createElement("option",{key:n+"-cascade-options-0",value:this.state.value},"Please Select"),this.renderCascadeOption(s,t+1,e.text,n)));return o.push(c),this.limitCascade<=t&&this.handleChange(),o.map(function(e,t){return e})}},{key:"renderCascadeOption",value:function(e,t,a){if(e)return e.map(function(e,t){return r.a.createElement("option",{key:a+"-cascade-options-"+t,value:e.id},e.name)})}},{key:"getCascadeDropdown",value:function(e,t){if("cascade"===this.props.data.type){var a=this.instanceUrl;a=W+"cascade/"+a+"/"+this.props.data.cascadeResource+"/"+e;var n,r="options_"+e,o="cascade_"+t,i=this.props.value.cascade,s=!1;if(i.length>0&&(s=!0),s&&(n=i.filter(function(e){return e.url===a})[0]),n)try{var c;this.setState((c={},Object(m.a)(c,r,n.data),Object(m.a)(c,o,[r]),Object(m.a)(c,"value",n.data[t].id),c))}catch(l){localStorage.removeItem(this.props.data.id)}n||(this.fetchCascade(e,t,a,r,o),console.log("NEW CASCADE"))}}},{key:"fetchCascade",value:function(e,t,a,n,r){var o=this;b.a.get(a).then(function(e){try{var a;o.setState((a={},Object(m.a)(a,n,e.data),Object(m.a)(a,r,[n]),Object(m.a)(a,"value",e.data[t].id),a))}catch(i){localStorage.removeItem(o.props.data.id)}return e}).then(function(e){o.props.storeCascade({url:a,data:e.data})})}},{key:"getInput",value:function(e,t,a,n,o){return r.a.createElement("input",{className:"photo"===e.type?"form-control-file":"form-control",value:n||"",min:a.minVal?a.minVal:"",max:a.maxVal?a.maxVal:"",key:t,type:o,name:"Q-"+e.id.toString(),onChange:this.handleChange})}},{key:"getInputOther",value:function(e,t,a,n){return r.a.createElement("input",{className:"photo"===e.type?"form-control-file":"form-control",value:a||"",key:t,type:n,name:"Q-"+e.id.toString(),onChange:this.handleChange})}},{key:"getPhoto",value:function(e,t,a,n){var o=this;return r.a.createElement(L.FilePond,{server:{url:W,process:{url:"./upload-image",method:"POST",onload:function(e){return o.handlePhoto(e),e.key},onerror:function(e){return e.data},ondata:function(e){return e.append("Status","Uploaded"),e}},patch:{url:"./upload-image",method:"GET",onload:function(e){return o.handlePhoto(e),e.key},onerror:function(e){return e.data}},revert:{url:"./delete-image/"+localStorage.getItem(e.id),method:"GET",onload:function(t){localStorage.removeItem(e.id)}}},key:t,allowMultiple:!1,name:"Q-"+e.id.toString(),"data-max-file-size":"500kb"})}},{key:"getTextArea",value:function(e,t,a,n){return r.a.createElement("textarea",{key:t,rows:"3",className:"form-control",value:a||"",type:n,onChange:this.handleChange,name:"Q-"+e.id.toString()})}},{key:"componentDidMount",value:function(){"cascade"===this.props.data.type&&(localStorage.removeItem(this.props.data.id),this.getCascadeDropdown(0,0)),null!==localStorage.getItem(this.props.data.id)&&this.props.checkSubmission()}},{key:"render",value:function(){var e=this.props.data,t="question-form-"+e.id.toString(),a=e.type,n=localStorage.getItem(e.id);switch(e.localeNameFlag&&this.setDpStorage(),a){case"option":return this.getRadio(e,t);case"cascade":return this.getCascade(e,0,t);case"number":return this.getInput(e,t,e.validationRule,n,a);case"photo":return this.getPhoto(e,t,n,"file");case"date":return this.getInputOther(e,t,n,a);default:return this.getTextArea(e,t,n,a)}}}]),t}(n.Component),V=Object(v.b)(O,y)(B),K=a(118),Z=a(119),$=a(120),X=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).getForms=a.getForms.bind(Object(g.a)(a)),a.isJsonString=a.isJsonString.bind(Object(g.a)(a)),a.renderMandatoryIcon=a.renderMandatoryIcon.bind(Object(g.a)(a)),a.renderQuestion=a.renderQuestion.bind(Object(g.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"isJsonString",value:function(e){try{JSON.parse(e)}catch(t){return!1}return!0}},{key:"renderQuestion",value:function(e,t){return r.a.createElement(V,{key:"question-type-"+e,data:t})}},{key:"renderMandatoryIcon",value:function(e){var t=!1;return localStorage.getItem(e)&&(t=!0),function(e){return e?r.a.createElement(R.c,{color:"green",className:"float-right"}):r.a.createElement(R.d,{color:"red",className:"float-right"})}(t)}},{key:"getForms",value:function(e){var t=this;return e.map(function(e){var a=e.id.toString();return r.a.createElement(K.a,{key:"card-"+a,className:!1===e.show?"d-none":""},r.a.createElement(Z.a,{key:"card-body-"+a,id:"card-body-"+a},r.a.createElement($.a,{key:"card-title-"+a},e.order.toString()+". "+e.text,e.mandatory?t.renderMandatoryIcon(a):""),t.renderQuestion(a,e)))})}},{key:"render",value:function(){return this.getForms(this.props.value.questions)}}]),t}(n.Component),Y=Object(v.b)(O)(X),ee=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).showGroup=a.showGroup.bind(Object(g.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"showGroup",value:function(e){return this.props.changeGroup(e)}},{key:"render",value:function(){var e=this,t=this.props.value.groups.active<=1?"btn-secondary":"btn-primary",a=this.props.value.groups.active===this.props.value.groups.list.length?"btn-secondary":"btn-primary",n=this.props.value.groups.active-1,o=this.props.value.groups.active+1;return r.a.createElement("div",{className:"btn btn-group ml-auto mt-2 mt-lg-0"},r.a.createElement("button",{className:"btn "+t,onClick:function(){e.showGroup(n)}},"Prev"),r.a.createElement("button",{className:"btn "+a,onClick:function(){e.showGroup(o)}},"Next"))}}]),t}(n.Component),te=Object(v.b)(O,y)(ee),ae=a(124),ne=a(121),re=a(122),oe=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"sidebar-heading"},r.a.createElement("div",{className:"my-2"},r.a.createElement(ae.a,null,r.a.createElement(ne.a,null,r.a.createElement("img",{alt:"img-logo",src:"https://www.2scale.org/assets/default/img/logo_2scale_red.gif",className:"responsive-image"}),this.props.value.surveyName),r.a.createElement(re.a,null,"Survey ID: ",this.props.value.surveyId,r.a.createElement("br",null),"Version: ",this.props.value.version))))}}]),t}(n.Component),ie=Object(v.b)(O)(oe),se=a(60),ce=a(123),le="6Lejm74UAAAAAA6HkQwn6rkZ7mxGwIjOx_vgNzWC",ue=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleCaptcha=function(e){a.setState({captcha:e}),a.props.submitState(!0),null===a.state.captcha&&a.setState({expired:!0})},a.asyncScriptOnLoad=function(){a.setState({callback:"called!"})},a.showCaptcha=function(){return r.a.createElement(se.a,{style:{display:"block",overflow:"hidden",borderBottom:"1px solid #ddd",padding:"8px"},size:"normal",theme:"light",ref:a._reCaptchaRef,sitekey:le,onChange:a.handleCaptcha,asyncScriptOnLoad:a.asyncScriptOnLoad})},a.showPassword=function(){return r.a.createElement(n.Fragment,null,r.a.createElement("label",{className:"form-password-label",htmlFor:"submit-username"},"Username:"),r.a.createElement("input",{className:"form-control",type:"text",name:"submit-username",onChange:a.handleUser}),r.a.createElement("label",{className:"form-password-label",htmlFor:"submit-password"},"Password:"),r.a.createElement("input",{className:"form-control",type:"password",name:"submit-password",onChange:a.handlePassword}),r.a.createElement("hr",null))},a.showSpinner=function(e){return r.a.createElement(ce.a,{size:"sm",color:"light"})},a.showCaptcha=a.showCaptcha.bind(Object(g.a)(a)),a.showPassword=a.showPassword.bind(Object(g.a)(a)),a.submitForm=a.submitForm.bind(Object(g.a)(a)),a.handleCaptcha=a.handleCaptcha.bind(Object(g.a)(a)),a.handlePassword=a.handlePassword.bind(Object(g.a)(a)),a.handleUser=a.handleUser.bind(Object(g.a)(a)),a.showSpinner=a.showSpinner.bind(Object(g.a)(a)),a.state={_showCaptcha:a.props.value.captcha,_showSpinner:!1},a._reCaptchaRef=r.a.createRef(),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"handlePassword",value:function(e){console.log(e.target.value),localStorage.setItem("_password",e.target.value)}},{key:"handleUser",value:function(e){console.log(e.target.value),localStorage.setItem("_username",e.target.value)}},{key:"submitForm",value:function(){var e=this;localStorage.setItem("_submissionStop",Date.now()),this.setState({_showSpinner:!0});var t=JSON.stringify(localStorage).length.toString(),a=localStorage;b.a.post("https://2scale.tc.akvo.org/akvo-flow-web-api/submit-form",a,{headers:{"Content-Length":t,"Content-Type":"application/json"}}).then(function(t){return j()({icon:"success",title:"Success!",text:"New datapoint is sent! clearing form...",closeOnClickOutside:!1,closeOnEsc:!1,button:!1,timer:3200}),e.setState({_showSpinner:!1}),setTimeout(function(){localStorage.clear(),setTimeout(function(){window.location.reload()},3e3)},500),t}).catch(function(t,a){console.log(t,a),e.setState({_showSpinner:!1}),j()("Oops!","Something went wrong!","error")})}},{key:"render",value:function(){return r.a.createElement(n.Fragment,null,!!this.props.value.captcha&&this.showCaptcha(),r.a.createElement("div",{className:"submit-block"},!!this.props.value.submit&&this.showPassword(),r.a.createElement("button",{onClick:this.submitForm,className:"btn btn-block btn-"+(this.props.value.submit?"primary":"secondary"),disabled:!this.props.value.submit},this.state._showSpinner?r.a.createElement(ce.a,{size:"sm",color:"light"}):"",r.a.createElement("span",null,"Submit"))))}}]),t}(n.Component),de=Object(v.b)(O,y)(ue);function pe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}var he=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).updateData=function(e){a.props.loadQuestions(e),a.props.restoreAnswers(a.props.value.questions),localStorage.getItem("_dataPointName")&&a.props.reduceDataPoint(localStorage.getItem("_dataPointName")),a.props.changeGroup(1),localStorage.setItem("_version",e.version),localStorage.setItem("_instanceId",e.app);var t=[],n=[];Array.isArray(e.questionGroup)||(e.questionGroup=[e.questionGroup]),e.questionGroup.forEach(function(e){e.question.forEach(function(e,a){t.push(e.id),n.push(e.type.toUpperCase())})}),localStorage.setItem("questionId",t),localStorage.setItem("answerType",n),a.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?pe(a,!0).forEach(function(t){Object(m.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pe(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},e));var r=[Math.random().toString(36).slice(2).substring(1,5),Math.random().toString(36).slice(2).substring(1,5),Math.random().toString(36).slice(2).substring(1,5)];localStorage.setItem("_dataPointId",r.join("-")),localStorage.setItem("_submissionStart",Date.now()),localStorage.setItem("_deviceId","Akvo Flow Web")},a.updateQuestions=function(e){a.setState({questionIndex:e})},a.instance=a.props.match.params.instance,a.surveyId=a.props.match.params.surveyid,a.setFullscreen=a.setFullscreen.bind(Object(g.a)(a)),a.renderQuestions=a.renderQuestions.bind(Object(g.a)(a)),a.renderGroups=a.renderGroups.bind(Object(g.a)(a)),a.state={_fullScreen:!1,_rendered:!1},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"setFullscreen",value:function(){var e=this.state._fullscreen;this.setState({_fullscreen:!e})}},{key:"componentDidMount",value:function(){var e=this;this.props.generateUUID({}),this.props.changeSettings({_isLoading:!0}),localStorage.getItem("_formId")&&localStorage.getItem("_formId")!==this.surveyId&&localStorage.clear(),localStorage.setItem("_formId",this.surveyId),localStorage.setItem("_instanceId",this.instance),b.a.get("https://2scale.tc.akvo.org/akvo-flow-web-api/"+this.instance+"/"+this.surveyId+"/update").then(function(t){e.updateData(t.data),e.setState({_rendered:!0})}).catch(function(t){console.log(t),j()("Oops!","Something went wrong!","error"),console.log(e.state)}),setTimeout(function(){e.setState({load:!0})},1e7)}},{key:"renderQuestions",value:function(){return r.a.createElement(Y,null)}},{key:"renderGroups",value:function(){return r.a.createElement(D,null)}},{key:"render",value:function(){return r.a.createElement("div",{className:this.state._fullscreen?"wrapper d-flex toggled":"wrapper d-flex"},r.a.createElement("div",{className:"sidebar-wrapper bg-light border-right"},r.a.createElement(ie,null),this.state._rendered?this.renderGroups():"",1===this.props.value.questions.length?"":r.a.createElement(de,null)),r.a.createElement("div",{className:"page-content-wrapper"},r.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light border-bottom"},r.a.createElement("button",{className:"btn btn-primary",onClick:this.setFullscreen},this.state._fullscreen?r.a.createElement(R.b,null):r.a.createElement(R.a,null)),1===this.props.value.questions.length?"":r.a.createElement(T,null),r.a.createElement(te,null)),r.a.createElement("div",{className:"container-fluid fixed-container",key:"div-group-"+this.state.surveyId},r.a.createElement(G,null),this.state._rendered?this.renderQuestions():"")))}}]),t}(n.Component),me=Object(v.b)(O,y)(he),ge=a(30),fe=a(57),be=a.n(fe);function ve(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function Oe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ve(a,!0).forEach(function(t){Object(m.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ve(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var ye={surveyName:"Loading..",surveyId:"Loading..",version:"Loading..",questions:[{group:1,heading:null,id:1,localeNameFlag:!1,mandatory:!1,order:1,show:!1,text:"Loading",type:"text",validation:!1}],active:[],answers:[],mandatory:[],submit:!1,captcha:!1,datapoint:null,datapoints:[],uuid:"LOADING",groups:{list:[{index:1,heading:"Loading Questions"}],active:1},pages:{},cascade:[]},Se=function(e){var t=[];return Array.isArray(e)&&(t=e),"object"===typeof e&&t.push({index:0,heading:e.heading,question:e.question}),t},je=function(e){var t,a=function(e,t){return e.map(function(e){return function(e,t){return Oe({},e,{id:parseInt(e.id),order:parseInt(e.order),type:F(e),group:t.index+1,heading:t.heading,validation:!!e.validationRule&&e.validationRule,show:!1})}(e,t)})},n=Se(e.questionGroup).map(function(e,t){return Oe({},e,{question:a(e.question,{heading:e.heading,index:t})})}).map(function(e){return e.question});return(t=[]).concat.apply(t,Object(U.a)(n))},we=function(e){var t=Se(e.questionGroup);return je(t).filter(function(e){return e.localeNameFlag}).map(function(e){return e.id})},Ee=function(e){return je(e).filter(function(e){return e.mandatory}).map(function(e){return e.id})},Ie=function(e,t){var a=[];return e.map(function(e){var n=!0,r=!1;if(e.dependency&&(r=e.dependency,n=!1),r){var o;if(r["answer-value"].includes("|")>-1&&(o=(o=r["answer-value"].split("|")).map(function(e){return isNaN(e)||(e=parseInt(e)),e})),null!==localStorage.getItem(r.question)){var i=localStorage.getItem(r.question);Q(o)&&(i=JSON.parse(o)),isNaN(o)||(i=i.toString()),o.includes(i)&&(n=!0),i===o&&(n=!0)}null===localStorage.getItem(parseInt(r.question))&&(n=!1,localStorage.removeItem(e.id))}(t&&e.group!==t&&(n=!1),t||n)||(localStorage.removeItem(e.id),r&&!1===a.find(function(e){return parseInt(e.id)===parseInt(r.question)}).show&&(n=!1));return a.push(Oe({},e,{show:n,type:F(e)})),Oe({},e,{show:n,type:F(e)})})},ke=function(e){return e},Ce=function(e,t,a){return e.map(function(e){var n=null;if(a){n=t.getItem(e.id)||null;try{n=JSON.parse(n)}catch(r){}n=parseInt(n).isNan?parseInt(n):n}return{id:e.id,answer:n,mandatory:e.mandatory}})},Ne=function(){var e=be()();return(e=(e=e.split("-")).map(function(e){return e.substring(0,4)}).slice(0,3)).join("-")},Pe=function(e,t){var a=Ie(t,!1).filter(function(e){return e.show});e=e.filter(function(e){return e.mandatory}).filter(function(e){return null!==e.answer});var n=a.map(function(t){var a=e.filter(function(e){return e.id===t.id}).map(function(e){return e.answer});return a=!(a.length<1),Oe({},t,{answered:a})}).filter(function(e){return e.mandatory});return n.filter(function(e){return e.answered}).length>=n.length},xe=function(e,t){return Oe({},e,{data:t})},_e=Object(ge.b)(function(){var e,t,a,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ye,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case"LOAD QUESTIONS":return Oe({},n,{surveyName:r.data.name,surveyId:r.data.surveyId,version:r.data.version,questions:je(r.data),datapoints:we(r.data),groups:(a=r.data,{list:Se(a.questionGroup).map(function(e,t){return{index:t+1,heading:e.heading}}),active:1}),mandatory:Ee(r.data)});case"RESTORE ANSWERS":return Oe({},n,{answers:Ce(r.data,localStorage,!0)});case"REDUCE ANSWER":return Oe({},n,{answers:Ce(n.answers,r.answer,!1)});case"REDUCE DATAPOINT":return Oe({},n,{datapoint:ke(r.data)});case"CHANGE GROUP":return Oe({},n,{questions:Ie(n.questions,r.group),groups:Oe({},n.groups,{active:r.group})});case"CHECK SUBMISSION":return Oe({},n,{captcha:Pe(n.answers,n.questions),submit:!1});case"SUBMIT STATE":return Oe({},n,{submit:r.data});case"GENERATE UUID":return Oe({},n,{uuid:Ne(r.data)});case"PAGES SETTINGS":return Oe({},n,{pages:xe(n.pages,r.data)});case"STORE CASCADE":return Oe({},n,{cascade:(e=n.cascade,t=r.data,e.length<1?[t]:[].concat(Object(U.a)(e),[t]))});default:return n}}),De=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(v.a,{store:_e},r.a.createElement(p.a,null,r.a.createElement(h.a,{path:"/akvo-flow-web/:instance/:surveyid",render:function(e){return r.a.createElement(me,Object.assign({key:"home"},e))}})))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(113);if(a(114).config(),localStorage.getItem("questionId")){var Ae=localStorage.getItem("questionId").split(","),Ge=localStorage.getItem("answerType").split(","),Re=Ae.map(function(e,t){return{id:e,type:Ge[t]}}).filter(function(e){return"PHOTO"===e.type});Re.length>0&&Re.forEach(function(e){return localStorage.removeItem(e.id)})}i.a.render(r.a.createElement(De,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},33:function(e,t,a){},61:function(e,t,a){e.exports=a(117)}},[[61,1,2]]]);
//# sourceMappingURL=main.66edaf68.chunk.js.map